<p align="center">
  <a href="#">
    <img width="400" src="https://github.com/3Tecnos-Development/mono/assets/5139981/ec6daa7c-9107-46ae-9389-1e20e93cca39">
  </a>
</p>
<h1 align="center" style="color:purple">X-School</h1>

<h1 align="center">Curso de Desenvolvimento Full Stack com Node.js, React Native e Monorepo NX (DDD e SOLID)</h1>

<h1 align="center">DDD (Domain-driven Design)</h1>

### Aula 02

#### Entidades / Agregados (Entities / Aggregates)

Entidades s√£o objetos que possuem identidade pr√≥pria, caracter√≠sticas que mudam ao longo do tempo e comportamentos. Agregados s√£o grupos de entidades e value objects relacionados que s√£o tratados como uma √∫nica unidade coesa.

Caracter√≠sticas:

1. Identidade Distinta
   > [!NOTE] <span style="color:purple"> Uma Entidade √© algo que tem uma identidade √∫nica que n√£o √© baseada apenas em seus atributos. Mesmo que dois objetos tenham os mesmos valores para todos os seus atributos, eles ainda s√£o considerados diferentes se tiverem identidades distintas.
2. Mutabilidade
   > [!NOTE] <span style="color:purple"> As Entidades podem ter atributos que mudam ao longo do tempo. Isso significa que os estados internos de uma Entidade podem ser alterados, e essas mudan√ßas s√£o parte integrante do ciclo de vida da Entidade.
3. Referencial de Identidade
   > [!NOTE] <span style="color:purple"> Em DDD, Entidades s√£o identificadas por meio de um identificador √∫nico, muitas vezes chamado de "ID". Esse identificador √© usado para rastrear e diferenciar Entidades em diferentes partes do sistema.
4. Comportamento Importante
   > [!NOTE] <span style="color:purple"> Entidades n√£o s√£o apenas recipientes de dados. Elas tamb√©m t√™m comportamento associado a elas, que √© relevante para o dom√≠nio em que est√£o inseridas.
5. Consist√™ncia de Agregados
   > [!NOTE] <span style="color:purple"> Entidades frequentemente fazem parte de Agregados, que s√£o grupos de Entidades e Value Objects relacionados que s√£o tratados como uma unidade coesa. Agregados s√£o delimitadores de transa√ß√µes e garantem a consist√™ncia das opera√ß√µes realizadas em suas partes componentes.

##### Vejamos alguns exemplos:

üí° Entidade _Servidor_

```typescript
import { Entity } from "@3tecnos/arch/domain";
import { currentDate } from "@3tecnos/util";

export type ServidorProps = {
  createdAt: string;
  id: string;
  nascimento: Date;
  nome: string;
  situacao: string;
};

// ‚ö†Ô∏è Especificando as propriedades de cria√ß√£o avulsa
export type CriarServidorProps = {
  nascimento: Date;
  nome: string;
  situacao: string;
};

// ‚ö†Ô∏è Removendo propriedade de forma simples
export type CriarServidorMigradoProps = Omit<CriarServidorProps, "situacao">;

export class Servidor extends Entity<ServidorProps> {
  // ‚ö†Ô∏è Introdu√ß√£o a comportamentos e a√ß√µes (sempre no infinitivo)
  static criar(props: CriarServidorProps): Servidor {
    return new Servidor({
      ...props,
      id: ServidorId.generateNew().value,
      createdAt: currentDate(),
    });
  }

  static criarMigrado(props: CriarServidorMigradoProps): Servidor {
    return this.criar({ ...props, situacao: "Migrado" });
  }

  public inativar() {
    if (this.state.situacao.podeInativar) this.state.situacao = "Inativo";
  }

  protected parse(props: ServidorProps): ServidorProps {
    return {
      id: props.id,
      createdAt: props.createdAt,
      nome: props.nome,
      nascimento: props.nascimento,
      situacao: props.situacao,
    };
  }
}
```

üí° Agregado _Servidor_

```typescript

//üí° Entidade Dependente
...

export type DependenteProps = {
  createdAt: string;
  id: string;
  nome: string;
};

export class Dependente extends Entity<DependenteProps> {
  ...

  protected parse(props: DependenteProps): DependenteProps {
    ...
  }
}

//üí° Entidade Servidor

...

export type ServidorProps = {
  createdAt: string;
  id: string;
  nascimento: Date;
  nome: string;
  situacao: string;
  // ‚ö†Ô∏è Introdu√ß√£o a entidade dependentes de outra entidade
  dependentes: Dependente[];
};

export class Servidor extends Entity<ServidorProps> {
  ...

  // ‚ö†Ô∏è Opera√ß√£o coesa entre a entidade dependente e seu agregado
  adicionarDependente(dependente: Dependente) {
    this.dependentes.push(dependente);
  }

  protected parse(props: ServidorProps): ServidorProps {

    const dependentes = (props.dependentes || []).map((dependente) => new Dependente(dependente)); = (props.dependentes || []).map((dependente) => new Dependente(dependente));

    return {
      id: props.id,
      createdAt: props.createdAt,
      nome: props.nome,
      nascimento: props.nascimento,
      situacao: props.situacao,
	  dependentes
    };
  }
}
```

üí° Agregado _Documento_

```typescript

//üí° Entidade Assinante

export type AssinanteProps = {
  createdAt: string;
  cpf: string;
  nome: string;
  ordem: number;
};

export class Assinante extends Entity<AssinanteProps> {

  protected parse(props: ServidorProps): AssinanteProps {
    ...
  }
}

//üí° Entidade Documento

import { Entity } from "@3tecnos/arch/domain";

export type DocumentoProps = {
  createdAt: string;
  id: string;
  nome: string;
  situacao: string;
  pendente: boolean;
  proximosAssinantesCPFs: Assinante[];
};

export class Documento extends Entity<DocumentoProps> {

  assinantePodeAssinar(assinante: Assinante): boolean {
    return (
      this.pendente.value &&
      this.situacao.pendente &&
      this.state.proximosAssinantesCPFs.some((proximoAssinanteCPF) => proximoAssinanteCPF.equals(assinante.cpf))

    );
  }

  descartar() {
    ...
  }

  restaurar() {
    ...
  }

  protected parse(props: ServidorProps): State {
    ...
  }
}
```
